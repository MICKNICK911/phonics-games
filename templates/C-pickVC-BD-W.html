<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Word blend ¬∑ digraph tap</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Arial', sans-serif;
        }

        body {
            overflow: hidden;
            height: 100vh;
            width: 100vw;
            touch-action: manipulation;
            background: #f5f7fa;
        }

        #gameContainer {
            position: relative;
            width: 100%;
            height: 100%;
        }

        .page {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1.5rem;
            flex-wrap: wrap;
            padding: 1rem;
            transition: transform 0.4s cubic-bezier(0.22, 1, 0.36, 1);
            top: 0;
            left: 0;
        }

        .letter {
            cursor: pointer;
            width: 7rem;
            height: 7rem;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            transition: all 0.2s ease, opacity 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            background-color: #4fc3f7;
            color: white;
            opacity: 0;
            animation: fadeIn 0.3s ease forwards;
            text-align: center;
            word-break: break-word;
            white-space: normal;
            line-height: 1.2;
            padding: 0.4rem;
        }

        @keyframes fadeIn {
            to { opacity: 1; }
        }

        .letter:hover, .letter:active {
            transform: scale(1.05);
        }

        .correct {
            animation: flashCorrect 0.2s ease;
        }

        .incorrect {
            animation: flashIncorrect 0.2s ease;
        }

        @keyframes flashCorrect {
            0% { background-color: #66bb6a; }
            100% { background-color: #4fc3f7; }
        }

        @keyframes flashIncorrect {
            0% { background-color: #ef5350; }
            100% { background-color: #4fc3f7; }
        }

        #gameOver, #levelComplete, #winScreen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            color: white;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            font-size: 2rem;
            z-index: 100;
            text-align: center;
            padding: 1rem;
        }

        #gameOver h2, #levelComplete h2, #winScreen h2 {
            margin-bottom: 1rem;
            font-size: 3rem;
        }

        #gameOver p, #levelComplete p, #winScreen p {
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }

        .btn {
            padding: 1rem 2rem;
            font-size: 1.2rem;
            margin: 0.5rem;
            cursor: pointer;
            background: #fff;
            border: none;
            border-radius: 50px;
            font-weight: bold;
            transition: all 0.2s;
            min-width: 200px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .btn-primary {
            background-color: #4fc3f7;
            color: white;
        }

        #header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: rgba(255, 255, 255, 0.9);
            z-index: 10;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .score-display, .time-display, .high-score-display {
            font-size: 1.5rem;
            font-weight: bold;
            padding: 0.5rem 1rem;
            border-radius: 50px;
            background-color: #e3f2fd;
        }

        #targetLimitContainer {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.2rem;
            font-weight: bold;
            background-color: #e3f2fd;
            padding: 0.5rem 1rem;
            border-radius: 50px;
        }

        #targetLimit {
            font-size: 1.2rem;
            text-align: center;
            font-weight: bold;
            background-color: transparent;
            border: none;
            color: #0288d1;
            width: 60px;
            pointer-events: none;
        }

        #targetProgress {
            width: 100%;
            height: 10px;
            background-color: #e0e0e0;
            border-radius: 5px;
            margin-top: 5px;
            overflow: hidden;
        }

        #targetProgressFill {
            height: 100%;
            background-color: #66bb6a;
            width: 0%;
            transition: width 0.3s ease;
        }

        #soundToggle {
            padding: 0.8rem;
            font-size: 1.2rem;
            background-color: #66bb6a;
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
        }

        #levelIndicator {
            position: fixed;
            bottom: 1rem;
            left: 50%;
            transform: translateX(-50%);
            padding: 0.8rem 1.5rem;
            background-color: #ff9800;
            color: white;
            border: none;
            border-radius: 50px;
            font-weight: bold;
            z-index: 10;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            pointer-events: none;
        }

        @media (max-width: 768px) {
            .letter {
                width: 6rem;
                height: 6rem;
                font-size: 1.8rem;
            }
            .page {
                gap: 1rem;
            }
            #header {
                justify-content: center;
            }
            .score-display, .time-display, .high-score-display, #targetLimitContainer {
                font-size: 1.2rem;
                padding: 0.3rem 0.8rem;
            }
        }

        @media (max-width: 480px) {
            .letter {
                width: 5rem;
                height: 5rem;
                font-size: 1.5rem;
            }
            .page {
                gap: 0.8rem;
            }
            #header {
                flex-direction: column;
                align-items: stretch;
            }
            #gameOver h2, #levelComplete h2, #winScreen h2 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div id="gameContainer"></div>
    
    <div id="header">
        <div class="score-display">üèÜ Score: <span id="scoreValue">0</span></div>
        <div class="time-display">‚è±Ô∏è Time: <span id="timeValue">0</span>s</div>
        <div class="high-score-display">üèÖ Best: <span id="highScoreValue">0</span></div>
        <div id="targetLimitContainer">
            üéØ Target: 
            <span id="targetLimit">1</span>
            <div id="targetProgress">
                <div id="targetProgressFill"></div>
            </div>
        </div>
        <button id="soundToggle">üîä</button>
    </div>

    <div id="levelIndicator">Level 1: Blends</div>

    <div id="gameOver">
        <h2>Game Over!</h2>
        <p>Your score: <span id="finalScore">0</span></p>
        <p>Time played: <span id="finalTime">0</span>s</p>
        <p>Best score: <span id="finalHighScore">0</span></p>
        <p id="motivationalMessage"></p>
        <button class="btn btn-primary" onclick="restartCurrentLevel()">Try Again</button>
    </div>

    <div id="levelComplete">
        <h2>Level Complete! üéâ</h2>
        <p>You mastered the blends!</p>
        <p>Get ready for digraphs!</p>
        <p>Your score: <span id="levelScore">0</span></p>
        <p>Time: <span id="levelTime">0</span>s</p>
        <button class="btn btn-primary" onclick="startNextLevel()">Start Digraphs</button>
    </div>

    <div id="winScreen">
        <h2>Congratulations! üéâ</h2>
        <p>You completed both levels!</p>
        <p>Your score: <span id="winScore">0</span></p>
        <p>Time: <span id="winTime">0</span>s</p>
        <p>Best score: <span id="winHighScore">0</span></p>
        <p id="winMessage"></p>
        <button class="btn btn-primary" onclick="restartGame()">Play Again</button>
    </div>

    <script>
        (function() {
            // ---------- WORD LISTS (60 blends, 60 digraphs, no cross contamination) ----------
            const blendWords = [
                // each blend appears at least once, 60 total
                "blot", "blue",           // bl
                "clap", "clog",           // cl
                "flag", "flip",           // fl
                "glass", "glue",          // gl
                "plant", "play",          // pl
                "and", "hand",             // nd
                "ant", "tent",             // nt
                "slip", "slow",            // sl
                "brim", "bran",            // br
                "crab", "crib",            // cr
                "drag", "drop",            // dr
                "frog", "from",            // fr
                "jump", "lamp",            // mp
                "card", "hard",            // rd
                "old", "cold",             // ld
                "help", "pulp",            // lp
                "grab", "grass",           // gr
                "pray", "press",           // pr
                "trap", "trip",            // tr
                "scab", "scan",            // sc
                "skip", "skin",            // sk
                "park", "bark",            // rk
                "golf", "elf",              // lf
                "kept", "wept",             // pt
                "left", "lift",             // ft
                "act", "fact",              // ct
                "squid", "squad",           // squ
                "stop", "step",             // st
                "smile", "smog",            // sm
                "snap", "snip",             // sn
                "spin", "spot",             // sp
                "milk", "silk",             // lk
                "salt", "belt",             // lt
                "text", "next",             // xt
                "cats", "hats",              // ts
                "swim", "swan",              // sw
                "twin", "twig",              // tw
                "dwell", "dwarf"             // dw
            ]; // exactly 60 (38 first + 22 from second list, carefully checked for digraphs)

            const digraphWords = [
                // ch (5)
                "chip", "chop", "chin", "chat", "chill",
                // tch (5)
                "catch", "hatch", "patch", "match", "fetch",
                // th (5)
                "this", "that", "thin", "thick", "thud",
                // ng (5)
                "king", "ring", "sing", "long", "thing",
                // nk (5)
                "ink", "sink", "link", "pink", "rink",
                // sh (5)
                "ship", "shop", "shut", "shed", "fish",
                // ck (5)
                "back", "duck", "pick", "sock", "luck",
                // wr (5)
                "wrap", "wren", "wreck", "wrist", "write",
                // ph (4)
                "phone", "photo", "dolphin", "phonics",
                // wh (4)
                "when", "whip", "whiz", "whale",
                // gn (4)
                "gnat", "gnaw", "sign", "gnome",
                // kn (4)
                "knot", "knit", "knock", "knife",
                // gh (4)
                "ghost", "ghoul", "aghast", "cough"
            ]; // total 60

            // ---------- GAME CONFIG ----------
            const bgColors = [
                '#FFEBEE', '#E8F5E9', '#E3F2FD', '#EDE7F6', '#FFF8E1',
                '#FCE4EC', '#E0F7FA', '#E8EAF6', '#F1F8E9', '#FFFDE7',
                '#EFEBE9', '#E0F2F1', '#F3E5F5', '#FBE9E7', '#EEEEEE'
            ];
            let colorIndex = 0;
            
            // Game state
            let score = 0;
            let timePlayed = 0;
            let timer;
            let currentLevel = 1; // 1 = blends, 2 = digraphs
            let currentPage = null;
            let gameActive = true;
            let highScore = localStorage.getItem('highScore') ? parseInt(localStorage.getItem('highScore')) : 0;
            let soundEnabled = true;
            const targetLimit = 30;

            // DOM elements
            const gameContainer = document.getElementById('gameContainer');
            const scoreValue = document.getElementById('scoreValue');
            const timeValue = document.getElementById('timeValue');
            const highScoreValue = document.getElementById('highScoreValue');
            const finalScore = document.getElementById('finalScore');
            const finalTime = document.getElementById('finalTime');
            const finalHighScore = document.getElementById('finalHighScore');
            const motivationalMessage = document.getElementById('motivationalMessage');
            const gameOver = document.getElementById('gameOver');
            const levelComplete = document.getElementById('levelComplete');
            const winScreen = document.getElementById('winScreen');
            const levelScore = document.getElementById('levelScore');
            const levelTime = document.getElementById('levelTime');
            const levelIndicator = document.getElementById('levelIndicator');
            const winScore = document.getElementById('winScore');
            const winTime = document.getElementById('winTime');
            const winHighScore = document.getElementById('winHighScore');
            const winMessage = document.getElementById('winMessage');
            const soundToggle = document.getElementById('soundToggle');
            const targetProgressFill = document.getElementById('targetProgressFill');

            // Audio context
            let audioCtx = null;

            function playSound(frequency, type = 'sine', duration = 0.1) {
                if (!soundEnabled) return;
                if (!audioCtx) {
                    audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                }
                if (audioCtx.state === 'suspended') {
                    audioCtx.resume();
                }
                const oscillator = audioCtx.createOscillator();
                const gainNode = audioCtx.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(audioCtx.destination);
                oscillator.type = type;
                oscillator.frequency.setValueAtTime(frequency, audioCtx.currentTime);
                gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);
                oscillator.start();
                oscillator.stop(audioCtx.currentTime + duration);
            }

            // Helper: random item
            function getRandomItem(array) {
                return array[Math.floor(Math.random() * array.length)];
            }

            // Get N distinct random items from array (simple, for small N)
            function getDistinctRandomItems(arr, count, excludeItem = null) {
                let copy = [...arr];
                if (excludeItem !== null) {
                    copy = copy.filter(item => item !== excludeItem);
                }
                // shuffle and take first 'count'
                for (let i = copy.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [copy[i], copy[j]] = [copy[j], copy[i]];
                }
                return copy.slice(0, count);
            }

            // Update target progress bar
            function updateTargetProgress() {
                const progress = (score / targetLimit) * 100;
                targetProgressFill.style.width = `${Math.min(progress, 100)}%`;
            }

            // Update level indicator
            function updateLevelIndicator() {
                if (currentLevel === 1) {
                    levelIndicator.textContent = "Level 1: Blends";
                    levelIndicator.style.backgroundColor = "#ff9800";
                } else {
                    levelIndicator.textContent = "Level 2: Digraphs";
                    levelIndicator.style.backgroundColor = "#4fc3f7";
                }
            }

            // Adjust font size based on word length
            function applyWordFontSize(element, word) {
                const len = word.length;
                if (len <= 4) element.style.fontSize = '2.5rem';
                else if (len === 5) element.style.fontSize = '2.2rem';
                else if (len === 6) element.style.fontSize = '2rem';
                else if (len === 7) element.style.fontSize = '1.8rem';
                else element.style.fontSize = '1.6rem';
                // responsive override handled by media queries, but this fine-tunes
            }

            // Create a new page with three words
            function createNewPage() {
                const page = document.createElement('div');
                page.className = 'page';
                page.style.backgroundColor = bgColors[colorIndex % bgColors.length];
                colorIndex++;

                const correctList = (currentLevel === 1) ? blendWords : digraphWords;
                const wrongList = (currentLevel === 1) ? digraphWords : blendWords;

                // pick one correct word
                const correctWord = getRandomItem(correctList);
                // pick two distinct wrong words (and not equal to correctWord, though lists are disjoint, but for safety)
                let wrongWords = getDistinctRandomItems(wrongList, 2, correctWord); 
                // in extremely rare case wrongList might not have 2 distinct? it does, size >=60.

                // combine and shuffle
                const words = [correctWord, ...wrongWords];
                shuffleArray(words);

                words.forEach(word => {
                    const wordElement = document.createElement('div');
                    wordElement.className = 'letter';
                    wordElement.textContent = word;
                    applyWordFontSize(wordElement, word);
                    
                    wordElement.onclick = () => handleWordClick(word, page, wordElement);
                    page.appendChild(wordElement);
                });

                gameContainer.appendChild(page);

                if (currentPage) {
                    currentPage.style.transform = 'translateY(-100%)';
                }

                currentPage = page;
                return page;
            }

            // Shuffle array
            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
            }

            // Check if word belongs to current level (correct category)
            function isCorrectWord(word) {
                if (currentLevel === 1) {
                    return blendWords.includes(word);
                } else {
                    return digraphWords.includes(word);
                }
            }

            // Handle word click
            function handleWordClick(word, currentPage, wordElement) {
                if (!gameActive) return;

                const correct = isCorrectWord(word);

                if (correct) {
                    score++;
                    playSound(440); // correct
                    wordElement.classList.add('correct');
                    updateScore();
                    updateTargetProgress();

                    // check if reached target limit
                    if (score >= targetLimit) {
                        if (currentLevel === 1) {
                            completeLevel();
                        } else {
                            winGame();
                        }
                        return;
                    }

                    // transition to next page
                    const newPage = createNewPage();
                    newPage.style.transform = 'translateY(100%)';

                    setTimeout(() => {
                        currentPage.style.transform = 'translateY(-100%)';
                        newPage.style.transform = 'translateY(0)';
                    }, 10);
                } else {
                    playSound(220, 'square', 0.2); // incorrect
                    wordElement.classList.add('incorrect');
                    endGame();
                }
            }

            // Update score and high score
            function updateScore() {
                scoreValue.textContent = score;
                if (score > highScore) {
                    highScore = score;
                    localStorage.setItem('highScore', highScore);
                    updateHighScore();
                }
            }

            function updateHighScore() {
                highScoreValue.textContent = highScore;
                finalHighScore.textContent = highScore;
                winHighScore.textContent = highScore;
            }

            // Timer
            function startTimer() {
                clearInterval(timer);
                timeValue.textContent = timePlayed;
                timer = setInterval(() => {
                    timePlayed++;
                    timeValue.textContent = timePlayed;
                }, 1000);
            }

            // Level complete (blend level finished)
            function completeLevel() {
                gameActive = false;
                clearInterval(timer);
                levelScore.textContent = score;
                levelTime.textContent = timePlayed;
                levelComplete.style.display = 'flex';
            }

            // Start next level (digraphs)
            function startNextLevel() {
                currentLevel = 2;
                score = 0;
                timePlayed = 0;
                gameActive = true;
                colorIndex = 0;
                updateScore();
                updateTargetProgress();
                startTimer();
                gameContainer.innerHTML = '';
                levelComplete.style.display = 'none';
                updateLevelIndicator();
                createNewPage();
            }

            // Game over (wrong tap)
            function endGame() {
                gameActive = false;
                clearInterval(timer);
                finalScore.textContent = score;
                finalTime.textContent = timePlayed;
                finalHighScore.textContent = highScore;
                motivationalMessage.textContent = getMotivationalMessage(score);
                gameOver.style.display = 'flex';
            }

            // Win both levels
            function winGame() {
                gameActive = false;
                clearInterval(timer);
                winScore.textContent = score;
                winTime.textContent = timePlayed;
                winHighScore.textContent = highScore;
                winMessage.textContent = getWinMessage(score, timePlayed);
                winScreen.style.display = 'flex';
            }

            function getMotivationalMessage(score) {
                if (score >= 50) return "Incredible! You're a word wizard!";
                if (score >= 30) return "Amazing! You really know your words!";
                if (score >= 15) return "Good job! Keep practicing!";
                return "Don't give up! Every tap counts.";
            }

            function getWinMessage(score, time) {
                if (time < 35) return "Lightning fast! You're a reading champion!";
                return "Fantastic! You've mastered blends and digraphs!";
            }

            // Restart current level (after game over)
            function restartCurrentLevel() {
                score = 0;
                timePlayed = 0;
                gameActive = true;
                colorIndex = 0;
                updateScore();
                updateTargetProgress();
                startTimer();
                gameContainer.innerHTML = '';
                gameOver.style.display = 'none';
                createNewPage();
            }

            // Restart entire game
            function restartGame() {
                winScreen.style.display = 'none';
                currentLevel = 1;
                score = 0;
                timePlayed = 0;
                gameActive = true;
                colorIndex = 0;
                updateScore();
                updateTargetProgress();
                startTimer();
                gameContainer.innerHTML = '';
                updateLevelIndicator();
                createNewPage();
            }

            // Toggle sound
            function toggleSound() {
                soundEnabled = !soundEnabled;
                soundToggle.textContent = soundEnabled ? 'üîä' : 'üîá';
            }

            // Initialize
            function initGame() {
                score = 0;
                timePlayed = 0;
                gameActive = true;
                colorIndex = 0;
                currentLevel = 1;
                updateScore();
                updateHighScore();
                updateTargetProgress();
                startTimer();
                gameContainer.innerHTML = '';
                updateLevelIndicator();
                createNewPage();
            }

            // Expose functions to global for button onclick
            window.restartCurrentLevel = restartCurrentLevel;
            window.startNextLevel = startNextLevel;
            window.restartGame = restartGame;

            // Event listeners
            soundToggle.addEventListener('click', toggleSound);
            window.addEventListener('load', () => {
                updateHighScore();
                updateTargetProgress();
                initGame();
            });
            window.addEventListener('touchstart', function() {}, { passive: true });
        })();
    </script>
</body>
</html>